<%- include('../particles/header.ejs') %>

    <div class="min-h-screen max-w-screen-2xl  mx-auto bg-[#dfdfdf]">
        <!-- <div class="max-w-20 h-80">
            <div class="gradient"><img class="fone__image" src="/img/человекПаук.jpg"></div>
        </div> -->

        <div class="max-w-6xl min-h-screen p-5 bg-white  relative mx-auto" id="films">
            <div class="">
                <input type="hidden" name="nameId" value="<%= items.name %>">
                <div class="relative text-center top-28 w-full bg-slate-200">
                    <h2 class="relative   text-5xl font-bold" id="name">
                        <%= items.name %>
                    </h2>
                </div>


                <div class="relative top-32 w-96">
                    <img class=" h-96 w-[255px] absolute  top-0" src="/img/<%= items.image %>">

                    <div class="absolute mt-3 w-64 h-20 top-96 text-xl  text-black rounded-xl bg-slate-300"
                        id="averange">
                        <% if (number>= 4.5) { %>
                            <font size="5" class="relative top-3 ml-5">рейтинг:</font>

                            <div
                                class="w-20 text-center py-5 my-2 mr-1 bg-lime-600 text-white font-semibold rounded-lg relative float-right">
                                <span class="averangeText" id="averangeText">
                                    <%= number %>
                                </span>

                            </div>
                            <% } else if(number>= 3.5) { %>
                                <font size="5" class="relative top-3 ml-5">рейтинг:</font>

                                <div
                                    class="w-20 text-center py-5 my-2 mr-1 bg-yellow-200 text-white font-semibold rounded-lg relative float-right">
                                    <span class="averangeText" id="averangeText">
                                        <%= number %>
                                    </span>

                                </div>
                                <% } else if( number>= 2 ) { %>
                                    <font size="5" class="relative top-3 ml-5">рейтинг:</font>

                                    <div
                                        class="w-20 text-center py-5 my-2 mr-1 bg-orange-500 text-white font-semibold rounded-lg relative float-right">
                                        <span class="averangeText" id="averangeText">
                                            <%= number %>
                                        </span>

                                    </div>
                                    <% } else { %>
                                        <font size="5" class="relative top-3 ml-5">рейтинг:</font>

                                        <div
                                            class="w-20 text-center py-5 my-2 mr-1 bg-red-600 text-white font-semibold rounded-lg relative float-right">
                                            <span class="averangeText" id="averangeText">
                                                <%= number %>
                                            </span>

                                        </div>
                                        <% } %>
                                            <div class="relative ml-5 text-sm top-6" id="voices">
                                                всего голосов:<span class="textVoises" id="textViews">
                                                    <%= voices %>
                                                </span></div>
                    </div>

                    <span class="relative text-2xl font-bold left-80 top-8 ">О фильме:</span>
                    <div class="relative top-12">

                        <div class=" absolute top-0 text-lg    left-96 " id="genre">
                            <div class="title__text">Жанр:</div>
                            <span class="relative bottom-6  font-bold float-left left-72" id="textViews">
                                <%= items.genre %>
                            </span>
                        </div>

                        <div class=" absolute top-8  text-lg   left-96  " id="country">
                            <div class="title__text">Страна: </div> <span
                                class="relative bottom-6 font-bold float-left left-72" id="textViews">
                                <%= items.country %>
                            </span>
                        </div>

                        <div class=" absolute top-16 text-lg   left-96">
                            <div class="title__text">год:</div> <span
                                class="relative bottom-6 font-bold float-left left-72" id="textViews">
                                <%= items.year %>
                            </span>
                        </div>

                        <div class="absolute top-24  text-lg  left-96" id="actor">
                            <div class="title__text">актеры:</div>
                            <span class="relative bottom-6 font-bold float-left left-72" id="textViews">
                                <%= items.actor %>
                            </span>
                        </div>
                        <div class="absolute top-32  text-lg  left-96" id="producer">
                            <div class="title__text">продюсер:</div> <span
                                class="relative bottom-6 font-bold float-left left-72 " id="textViews">
                                <%= items.producer %>
                            </span>
                        </div>

                        <div class="absolute top-40  text-lg   left-96" id="screenwriter">
                            <div class="title__text">сценарист:</div> <span
                                class="relative bottom-6 font-bold float-left left-72 " id="textViews">
                                <%= items.screenwriter %>
                            </span>
                        </div>
                        <div class="absolute top-48  text-lg   left-96" id="operator">
                            <div class="title__text">оператор:</div> <span
                                class="relative bottom-6 font-bold float-left left-72" id="textViews">
                                <%= items.operator%>
                            </span>
                        </div>
                        <div class="absolute top-56  text-lg  left-96" id="regicer">
                            <div class="title__text">режиссер:</div> <span
                                class="relative bottom-6 font-bold float-left left-72" id="textViews">
                                <%= items.regicer %>
                            </span>
                        </div>


                       


                        <div class="absolute top-80  text-lg  left-96 " id="description">
                            <div class="title__text">описание:</div>
                            <p>
                                <%= items.description %>
                            </p>

                        </div>
                    </div>
                </div>



                <% if (items.status=="бесплатно" ) { %>
                    <!-- FREE -->
                <% } else { %>
                    <!-- SUBSCRIBE -->
                <% } %>

            </div>
            <div>

                <!-- <iframe class="video" width="560" height="315" src="" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe> -->
            </div>




            
        </div>
        <!-- //////////////////////////////////////////////////////////////// -->

        <div class=" relative mx-auto my-4  text-center  bg-slate-500 max-w-6xl  bottom-2" id="rating-wrapper">

            <form action="/rating/<%= items.id %>" method="post" id="rate-form">

                <!-- <input type="hidden" name="item__name" value="<%= items.name %>"> -->


                <% if (auth) { %>

                    <div class="grid text-center place-items-center bg-white  relative mx-auto my-4 items-center justify-center flex-col  max-w-6xl"
                        id="container">
                        <div id="post" class="hidden">
                            <div class=" text-xl py-6 text-gray-700">Thanks for rating us !</div>

                        </div>
                        <div id="star-widget" class="text-center items-center justify-center">
                            <ul class="grid text-center w-full grid-cols-5">
                                <% for (let i=0; i < 5; i++) { %>

                                    <li class="m-0">
                                        <input type="radio" name="rate" id="rate-<%= i %>" class=" hidden peer"
                                            value="<%= i %>" required>
                                        <label for="rate-<%= i %>"
                                            class="float-right text-2xl  text-gray-500 p-2 peer-checked:text-blue-600"><%- include('../icons/star__icon.ejs') %></label>
                                    </li>
                                    <% } %>
                            </ul>

                            <div class="relative ">

                                <div class="h-full outline-none p-2 text-xl w-full overflow-hidden">
                                    <textarea cols="30" placeholder="Describe your  experense..." type="text"
                                        name="text" required></textarea>
                                </div>
                                <div class="p-3 text-xl text-gray-600  w-full text-center mb-2 bg-slate-300">
                                    <p onclick="createRate()" id="button">Post</p>
                                </div>
                            </div>

                        </div>
                    </div>

                    <% if (mark == false ) { %>
                       
                            <script>
                                const button = document.getElementById("button")
                                const post = document.getElementById("post")
                                const widget = document.getElementById("star-widget")
                                const editBtn = document.getElementById("edit")

                                widget.classList.toggle("hidden");
                                post.classList.toggle("hidden");

                                button.addEventListener("click", () => {
                                    widget.classList.toggle("bg-green-400")
                                    post.classList.toggle("block");
                                })
                            </script>

                            <% } %>
                                <% } %>

                                    <script>
                                        async function createRate() {
                                            const post = document.getElementById("post")
                                            const widget = document.getElementById("star-widget")
                                            let ratingWrapper = document.getElementById('rating-wrapper');
                                            let RateForm = document.getElementById('rate-form');

                                            let rateFormData = new FormData(RateForm);
                                            // ratingWrapper.innerHTML = '';
                                            widget.classList.toggle("hidden");
                                            post.classList.toggle("hidden");

                                            await fetch(RateForm.action, {
                                                'method': 'POST',
                                                'body': JSON.stringify({
                                                    'rate': rateFormData.get('rate'),
                                                    'text': rateFormData.get('text'),

                                                }),
                                                'headers': {
                                                    'Content-Type': 'application/json',
                                                }
                                            })



                                        }


                                    </script>
            </form>
        </div>

        <div class="relative max-w-6xl mx-auto text-gray-700 p-7  bottom-3 h-full bg-white" id="comment">

            <div class="relative  text-4xl float-left block ">Комментарии:</div>

            <div class="relative mt-20" id="comment-wrapper">

            </div>
        </div>
    </div>


    <script>
        async function getCommentAndShow() {
            let commentWrapper = document.querySelector('#comment-wrapper');


            let response = await fetch('/api/v1/comments/<%= items.id %>/show');

            let comments = await response.json();

            comments[1].forEach(comment => {
                commentWrapper.innerHTML += `<div class="max-w-5xl min-h-[100px] relative  m-1 bg-gray-200 mx-auto">
                    <div name="userName" class="w-max relative right-0 text-left top-1 ml-3 border-b border-b-2px border-gray-700 font-bold">${comment.user__name}</div>
                    <div name="text" class="relative m-3 float-left left-3">${comment.text}</div>
                </div> 
                <% if (auth) { %>
                        <% if (items.name == name || admin) { %>
                    <form action="/delete/comment/${comment.id}" method="post">
                        <input type="hidden" name="commentId" value=" ${comment.id}">
                        <input type="hidden" name="itemsID" value="<%= items.id %>">
                        <input type="hidden" name="commentName" value=" ${comment.user__name}">
                        <input class="absolute float-right right-12 top-3 hover:bg-white duration-700 p-1" type="submit" value="delete">
                    </form>
                    <% } %>
                <% } %>
                `;
            });
        }

        getCommentAndShow();
    </script>



    <%- include('../particles/footer.ejs') %>